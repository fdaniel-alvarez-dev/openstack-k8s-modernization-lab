---
- name: local
  hosts: local
  gather_facts: true
  vars:
    out_dir: "./generated"
  tasks:
    - name: Ensure output directory exists
      ansible.builtin.file:
        path: "{{ out_dir }}"
        state: directory
        mode: "0755"

    - name: Render Kubernetes baseline manifest
      ansible.builtin.template:
        src: "templates/k8s_baseline.yaml.j2"
        dest: "{{ out_dir }}/k8s_baseline.yaml"
        mode: "0644"

    - name: Render OpenStack controller standard
      ansible.builtin.template:
        src: "templates/openstack_controller_standard.md.j2"
        dest: "{{ out_dir }}/openstack_controller_standard.md"
        mode: "0644"

    - name: Validate naming conventions (example)
      ansible.builtin.assert:
        that:
          - "'platform-system' in lookup('file', out_dir + '/k8s_baseline.yaml')"
        fail_msg: "Expected namespace 'platform-system' missing from rendered manifest."

